<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Price Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBDIPGK1OrEwE0PPm68pqiKiitdXynQ4xE",
      authDomain: "studio-5863851860-6ebc5.firebaseapp.com",
      projectId: "studio-5863851860-6ebc5",
      storageBucket: "studio-5863851860-6ebc5.firebasestorage.app",
      messagingSenderId: "403942263110",
      appId: "1:403942263110:web:1693659402a60ac6243d47"
    };

    // Icon components
    const Bell = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
    );

    const Plus = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const AlertCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
    );

    const TrendingUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const TrendingDown = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
        <polyline points="17 18 23 18 23 12"></polyline>
      </svg>
    );

    const RefreshCw = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
    );

    function PriceTracker() {
      const [items, setItems] = useState([]);
      const [url, setUrl] = useState('');
      const [name, setName] = useState('');
      const [loading, setLoading] = useState(false);
      const [notificationsEnabled, setNotificationsEnabled] = useState(false);
      const [error, setError] = useState('');
      const [success, setSuccess] = useState('');
      const [firebaseReady, setFirebaseReady] = useState(false);

      useEffect(() => {
        const script = document.createElement('script');
        script.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js';
        script.async = true;
        script.onload = () => {
          const firestoreScript = document.createElement('script');
          firestoreScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js';
          firestoreScript.async = true;
          firestoreScript.onload = () => {
            window.firebase.initializeApp(firebaseConfig);
            window.db = window.firebase.firestore();
            setFirebaseReady(true);
            loadItems();
          };
          document.head.appendChild(firestoreScript);
        };
        document.head.appendChild(script);

        checkNotificationPermission();
      }, []);

      const loadItems = async () => {
        if (!window.db) return;
        
        try {
          const snapshot = await window.db.collection('items').orderBy('lastChecked', 'desc').get();
          const loadedItems = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setItems(loadedItems);
        } catch (err) {
          console.log('Error loading items:', err);
        }
      };

      const checkNotificationPermission = () => {
        if ('Notification' in window) {
          setNotificationsEnabled(Notification.permission === 'granted');
        }
      };

      const requestNotificationPermission = async () => {
        if ('Notification' in window) {
          const permission = await Notification.requestPermission();
          setNotificationsEnabled(permission === 'granted');
          if (permission === 'granted') {
            new Notification('Price Tracker Active! ðŸ””', {
              body: 'You\'ll get alerts when prices change on your tracked items.',
            });
            setSuccess('Notifications enabled!');
            setTimeout(() => setSuccess(''), 3000);
          }
        }
      };

      const scrapePrice = async (itemUrl) => {
        return {
          price: (Math.random() * 100 + 10).toFixed(2),
          currency: '$',
          timestamp: Date.now()
        };
      };

      const addItem = async () => {
        if (!url || !name) {
          setError('Please enter both name and URL');
          setTimeout(() => setError(''), 3000);
          return;
        }

        if (!firebaseReady) {
          setError('Firebase is still loading, please wait...');
          setTimeout(() => setError(''), 3000);
          return;
        }

        setLoading(true);
        setError('');

        try {
          const priceData = await scrapePrice(url);
          const newItem = {
            name,
            url,
            currentPrice: priceData.price,
            previousPrice: null,
            currency: priceData.currency,
            lastChecked: priceData.timestamp,
            history: [{ price: priceData.price, timestamp: priceData.timestamp }]
          };

          const docRef = await window.db.collection('items').add(newItem);
          setItems([{ id: docRef.id, ...newItem }, ...items]);
          setUrl('');
          setName('');
          setSuccess('Item added successfully!');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError('Failed to add item: ' + err.message);
          setTimeout(() => setError(''), 5000);
        } finally {
          setLoading(false);
        }
      };

      const checkPrices = async () => {
        if (items.length === 0) {
          setError('No items to check');
          setTimeout(() => setError(''), 3000);
          return;
        }

        setLoading(true);
        const updatedItems = [];

        for (const item of items) {
          try {
            const priceData = await scrapePrice(item.url);
            const oldPrice = parseFloat(item.currentPrice);
            const newPrice = parseFloat(priceData.price);

            const updatedItem = {
              ...item,
              previousPrice: item.currentPrice,
              currentPrice: priceData.price,
              lastChecked: priceData.timestamp,
              history: [...(item.history || []), { price: priceData.price, timestamp: priceData.timestamp }]
            };

            await window.db.collection('items').doc(item.id).update({
              previousPrice: updatedItem.previousPrice,
              currentPrice: updatedItem.currentPrice,
              lastChecked: updatedItem.lastChecked,
              history: updatedItem.history
            });

            updatedItems.push(updatedItem);

            if (notificationsEnabled && Math.abs(oldPrice - newPrice) > 0.01) {
              const change = newPrice - oldPrice;
              const changeText = change > 0 
                ? `increased by ${item.currency}${Math.abs(change).toFixed(2)}` 
                : `dropped by ${item.currency}${Math.abs(change).toFixed(2)}`;
              
              new Notification(`ðŸ’° ${item.name}`, {
                body: `Price ${changeText}!\nNow ${item.currency}${newPrice}`,
              });
            }
          } catch (err) {
            updatedItems.push(item);
          }
        }

        setItems(updatedItems);
        setLoading(false);
        setSuccess('Prices updated!');
        setTimeout(() => setSuccess(''), 3000);
      };

      const removeItem = async (id) => {
        try {
          await window.db.collection('items').doc(id).delete();
          setItems(items.filter(item => item.id !== id));
          setSuccess('Item removed');
          setTimeout(() => setSuccess(''), 3000);
        } catch (err) {
          setError('Failed to remove item');
          setTimeout(() => setError(''), 3000);
        }
      };

      const getPriceChange = (item) => {
        if (!item.previousPrice) return null;
        const change = parseFloat(item.currentPrice) - parseFloat(item.previousPrice);
        return change;
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                    <Bell size={24} className="text-indigo-600" />
                    Price Tracker
                  </h1>
                  {firebaseReady && (
                    <p className="text-sm text-green-600 mt-1">âœ“ Connected to Firebase</p>
                  )}
                </div>
                {!notificationsEnabled && (
                  <button
                    onClick={requestNotificationPermission}
                    className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                  >
                    <Bell size={16} />
                    Enable Alerts
                  </button>
                )}
              </div>

              {error && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4 flex items-center gap-2 text-red-700">
                  <AlertCircle size={20} />
                  {error}
                </div>
              )}

              {success && (
                <div className="bg-green-50 border border-green-200 rounded-lg p-3 mb-4 text-green-700">
                  âœ“ {success}
                </div>
              )}

              <div className="space-y-3 mb-4">
                <input
                  type="text"
                  placeholder="Item name (e.g., iPhone 15 Pro)"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  disabled={!firebaseReady}
                />
                <input
                  type="url"
                  placeholder="Product URL (e.g., amazon.com/product-link)"
                  value={url}
                  onChange={(e) => setUrl(e.target.value)}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  disabled={!firebaseReady}
                />
                <button
                  onClick={addItem}
                  disabled={loading || !firebaseReady}
                  className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-medium flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <Plus size={20} />
                  {firebaseReady ? 'Add Item to Track' : 'Loading Firebase...'}
                </button>
              </div>

              {items.length > 0 && (
                <button
                  onClick={checkPrices}
                  disabled={loading}
                  className="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50 flex items-center justify-center gap-2"
                >
                  <RefreshCw size={20} className={loading ? 'animate-spin' : ''} />
                  {loading ? 'Checking Prices...' : 'Check All Prices Now'}
                </button>
              )}
            </div>

            <div className="space-y-4">
              {items.length === 0 ? (
                <div className="bg-white rounded-2xl shadow-lg p-12 text-center">
                  <Bell size={48} className="mx-auto text-gray-300 mb-4" />
                  <p className="text-gray-500 text-lg">No items yet. Add your first item to start tracking!</p>
                </div>
              ) : (
                items.map((item) => {
                  const change = getPriceChange(item);
                  return (
                    <div key={item.id} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <h3 className="text-xl font-bold text-gray-800 mb-2">{item.name}</h3>
                          <a
                            href={item.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-sm text-indigo-600 hover:underline mb-3 block truncate"
                          >
                            {item.url}
                          </a>
                          <div className="flex items-baseline gap-3">
                            <span className="text-3xl font-bold text-gray-900">
                              {item.currency}{item.currentPrice}
                            </span>
                            {change !== null && (
                              <div className={`flex items-center gap-1 ${change > 0 ? 'text-red-600' : 'text-green-600'}`}>
                                {change > 0 ? <TrendingUp size={16} /> : <TrendingDown size={16} />}
                                <span className="text-sm font-medium">
                                  {change > 0 ? '+' : ''}{item.currency}{change.toFixed(2)}
                                </span>
                              </div>
                            )}
                          </div>
                          <p className="text-sm text-gray-500 mt-2">
                            Last checked: {new Date(item.lastChecked).toLocaleString()}
                          </p>
                        </div>
                        <button
                          onClick={() => removeItem(item.id)}
                          className="text-red-500 hover:text-red-700 transition p-2"
                        >
                          <Trash2 size={20} />
                        </button>
                      </div>
                    </div>
                  );
                })
              )}
            </div>

            <div className="mt-8 bg-yellow-50 border border-yellow-200 rounded-xl p-4">
              <p className="text-sm text-yellow-800">
                <strong>Demo Mode:</strong> This app simulates price checking with random prices for demonstration. Your tracked items are saved in Firebase Firestore! In a real app, you'd need a backend service to scrape actual prices from websites.
              </p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<PriceTracker />, document.getElementById('root'));
  </script>
</body>
</html>